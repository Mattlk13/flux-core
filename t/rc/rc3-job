#!/bin/bash -e

RANK=$(flux getattr rank)

# Usage: modrm {all|<rank>} modname
modrm() {
    local where=$1; shift
    if test "$where" = "all" || test $where -eq $RANK; then
        flux module remove -f $*
    fi
}

modrm 0 job-exec
modrm 0 sched-simple
modrm 0 resource
modrm 0 job-manager
modrm all barrier
modrm 0 job-info
modrm all kvs-watch
modrm all job-ingest

modrm all kvs

flux content flush

modrm 0 content-sqlite
